<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fajas Magic - Marcaci√≥n</title>
    <style>
        /* CSS ACTUALIZADO PARA CENTRADO PERFECTO */
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: #f4f7f6; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100dvh; /* Centrado din√°mico en m√≥viles */
            margin: 0; 
            overflow: hidden;
        }

        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            width: 88%; 
            max-width: 340px; 
            text-align: center;
            box-sizing: border-box;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-container img {
            max-width: 100%;
            height: auto;
        }

        input#pin { 
            width: 100%; 
            padding: 12px;
            border: 2px solid #eee; 
            border-radius: 12px; 
            font-size: 2rem; 
            text-align: center; 
            margin-bottom: 15px; 
            outline: none;
            background: #fafafa;
            box-sizing: border-box;
        }

        input#pin:focus { border-color: #e6007e; }

        .nombre { font-weight: bold; color: #e6007e; margin-bottom: 15px; font-size: 1.1rem; min-height: 25px; }
        
        .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        button { 
            padding: 15px 5px; 
            border: none; 
            border-radius: 10px; 
            color: white; 
            font-weight: bold; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-size: 0.8rem; 
        }
        
        .ent { background: #27ae60; grid-column: span 2; }
        .pau { background: #f39c12; }
        .sal { background: #d32f2f; grid-column: span 2; }
        .rei { background: #2980b9; grid-column: span 2; }
        
        #msj { margin-top: 15px; font-size: 0.9rem; font-weight: bold; color: #666; }
    </style>
</head>
<body>

<div class="card">
    <div class="logo-container">
        <img src="https://drive.google.com/file/d/1Oiil2YTdSEhgto25g6kO1YYnMEBk_IOQ/view?usp=sharing" alt="Logo Magic">
    </div>
    
    <input type="password" id="pin" placeholder="PIN" maxlength="6" oninput="validar()" inputmode="numeric">
    
    <div id="nombre" class="nombre"></div>
    <div id="panel" class="btns" style="display:none"></div>
    <div id="msj"></div>
</div>

<script>
    // 1. REEMPLAZA CON TU URL DE GOOGLE SCRIPT
    const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyGNLVVrlvbtOwsZZPQ2bPN49FqRioIM9iPWBMH9jYC3lgtEwSru2f-Cf616lz2Uhg3/exec"; 
    let nombreEmpleado = "";

    async function validar() {
        const pinVal = document.getElementById('pin').value;
        const n = document.getElementById('nombre');
        const p = document.getElementById('panel');
        
        if (pinVal.length >= 4) {
            n.innerText = "Buscando...";
            try {
                const r = await fetch(URL_SCRIPT, { method: 'POST', body: JSON.stringify({accion:"consultar", pin:pinVal}) });
                const respuesta = await r.text();
                
                if (respuesta === "NO_EXISTE") {
                    n.innerText = "‚ùå PIN Incorrecto";
                    p.style.display = "none";
                } else {
                    const datos = respuesta.split("|");
                    nombreEmpleado = datos[0];
                    const estado = datos[1];
                    n.innerText = "üë§ " + nombreEmpleado;
                    mostrarBotones(estado);
                }
            } catch (e) { n.innerText = "Error de conexi√≥n"; }
        } else { n.innerText = ""; p.style.display = "none"; }
    }

    function mostrarBotones(est) {
        const p = document.getElementById('panel'); p.style.display = "grid"; p.innerHTML = "";
        if (est === "Salida") {
            p.innerHTML = '<button class="ent" onclick="solicitarGps(\'Entrada\')">ENTRADA</button>';
        } else if (est.includes("Pausa")) {
            p.innerHTML = '<button class="rei" onclick="solicitarGps(\'Reinicio\')">REINICIO</button>';
        } else {
            p.innerHTML = '<button class="pau" onclick="solicitarGps(\'Pausa Ba√±o\')">BA√ëO</button><button class="pau" onclick="solicitarGps(\'Pausa Break\')">BREAK</button><button class="pau" onclick="solicitarGps(\'Pausa Almuerzo\')">ALMUERZO</button><button class="sal" onclick="solicitarGps(\'Salida\')">SALIDA</button>';
        }
    }

    function solicitarGps(tipo) {
        document.getElementById('panel').style.display = "none";
        document.getElementById('msj').innerText = "üìç Localizando...";
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (pos) => enviar(tipo, "https://www.google.com/maps?q=" + pos.coords.latitude + "," + pos.coords.longitude),
                () => enviar(tipo, "GPS denegado"),
                { enableHighAccuracy: true, timeout: 15000 }
            );
        } else { enviar(tipo, "No soportado"); }
    }

    async function enviar(tipo, gps) {
        document.getElementById('msj').innerText = "‚è≥ Guardando...";
        const datos = { 
            accion: "registrar", 
            pin: document.getElementById('pin').value, 
            nombre: nombreEmpleado, 
            tipo: tipo, 
            fecha: new Date().toLocaleDateString(), 
            hora: new Date().toLocaleTimeString(), 
            ubicacion: gps 
        };
        await fetch(URL_SCRIPT, { method: 'POST', mode: 'no-cors', body: JSON.stringify(datos) });
        document.getElementById('msj').innerHTML = "<span style='color:green'>‚úÖ ¬°LISTO!</span>";
        setTimeout(() => location.reload(), 2000);
    }
</script>
</body>
</html>




